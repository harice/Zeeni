THREE.OrbitControls=function(a,b){function G(){return 2*Math.PI/60/60*e.autoRotateSpeed}function H(){return Math.pow(.95,e.zoomSpeed)}function I(a){if(e.enabled!==!1){if(a.preventDefault(),a.button===e.mouseButtons.ORBIT){if(e.noRotate===!0)return;A=z.ROTATE,g.set(a.clientX,a.clientY)}else if(a.button===e.mouseButtons.ZOOM){if(e.noZoom===!0)return;A=z.DOLLY,o.set(a.clientX,a.clientY)}else if(a.button===e.mouseButtons.PAN){if(e.noPan===!0)return;A=z.PAN,j.set(a.clientX,a.clientY)}A!==z.NONE&&(document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",L,!1),e.dispatchEvent(E))}}function J(a){this.object.position.y;a?e.pan(0,-e.keyPanSpeed):e.pan(0,e.keyPanSpeed),e.update()}function K(a){if(e.enabled!==!1){a.preventDefault();var b=e.domElement===document?e.domElement.body:e.domElement;if(A===z.ROTATE){if(e.noRotate===!0)return;h.set(a.clientX,a.clientY),i.subVectors(h,g),e.rotateLeft(2*Math.PI*i.x/b.clientWidth*e.rotateSpeed),e.rotateUp(2*Math.PI*i.y/b.clientHeight*e.rotateSpeed),a.clientY<c?(console&&console.log("From Bottom"),J(!0)):(J(!1)),c=a.clientY,g.copy(h)}else if(A===z.DOLLY){if(e.noZoom===!0)return;p.set(a.clientX,a.clientY),q.subVectors(p,o),q.y>0?e.dollyIn():q.y<0&&e.dollyOut(),o.copy(p)}else if(A===z.PAN){if(e.noPan===!0)return;k.set(a.clientX,a.clientY),l.subVectors(k,j),e.pan(l.x,l.y),j.copy(k)}A!==z.NONE&&e.update()}}function L(){e.enabled!==!1&&(document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",L,!1),e.dispatchEvent(F),A=z.NONE)}function M(a){if(e.enabled!==!1&&e.noZoom!==!0&&A===z.NONE){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail),b>0?e.dollyOut():b<0&&e.dollyIn(),d>190&&d<200&&e.reset(),e.update(),e.dispatchEvent(E),e.dispatchEvent(F)}}function N(a){}function O(a){if(e.enabled!==!1){switch(a.touches.length){case 1:if(e.noRotate===!0)return;A=z.TOUCH_ROTATE,g.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(e.noZoom===!0)return;A=z.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);o.set(0,d);break;case 3:if(e.noPan===!0)return;A=z.TOUCH_PAN,j.set(a.touches[0].pageX,a.touches[0].pageY);break;default:A=z.NONE}A!==z.NONE&&e.dispatchEvent(E)}}function P(a){if(e.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=e.domElement===document?e.domElement.body:e.domElement;switch(a.touches.length){case 1:if(e.noRotate===!0)return;if(A!==z.TOUCH_ROTATE)return;h.set(a.touches[0].pageX,a.touches[0].pageY),i.subVectors(h,g),e.rotateLeft(2*Math.PI*i.x/b.clientWidth*e.rotateSpeed),e.rotateUp(2*Math.PI*i.y/b.clientHeight*e.rotateSpeed),g.copy(h),a.touches[0].pageY<c?(console&&console.log("From Bottom"),J(!0)):(J(!1)),c=a.touches[0].pageY;break;case 2:if(e.noZoom===!0)return;if(A!==z.TOUCH_DOLLY)return;var f=a.touches[0].pageX-a.touches[1].pageX,j=a.touches[0].pageY-a.touches[1].pageY,k=Math.sqrt(f*f+j*j);p.set(0,k),q.subVectors(p,o),q.y>0?e.dollyOut():q.y<0&&e.dollyIn(),o.copy(p),d>190&&d<200&&e.reset(),e.update();break;case 3:break;default:A=z.NONE}}}function Q(){e.enabled!==!1&&(e.dispatchEvent(F),A=z.NONE)}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0;var c=0,d=200;this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=14,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var r,s,e=this,f=1e-6,g=new THREE.Vector2,h=new THREE.Vector2,i=new THREE.Vector2,j=new THREE.Vector2,k=new THREE.Vector2,l=new THREE.Vector2,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector2,p=new THREE.Vector2,q=new THREE.Vector2,t=0,u=0,v=1,w=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Quaternion,z={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},A=z.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var B=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),C=B.clone().inverse(),D={type:"change"},E={type:"start"},F={type:"end"};this.rotateLeft=function(a){void 0===a&&(a=G()),u-=a},this.rotateUp=function(a){void 0===a&&(a=G()),t-=a},this.panLeft=function(a){var b=this.object.matrix.elements;m.set(b[0],b[1],b[2]),m.multiplyScalar(-a),w.add(m)},this.panUp=function(a){var b=this.object.matrix.elements;m.set(b[4],b[5],b[6]),m.multiplyScalar(a),w.add(m)},this.pan=function(a,b){var c=e.domElement===document?e.domElement.body:e.domElement;if(e.object instanceof THREE.PerspectiveCamera){var f=e.object.position;if(console&&console.log("position.y : "+f.y+" , deltaY : "+b),d<180){var g=40;if(d<120&&d>100?g=30:d<150?g=20:d<180&&(g=10),f.y>-g&&b<0||f.y<g&&b>0){var h=f.clone().sub(e.target),i=h.length();i*=Math.tan(e.object.fov/2*Math.PI/180),e.panLeft(2*a*i/c.clientHeight),e.panUp(2*b*i/c.clientHeight)}}}else e.object instanceof THREE.OrthographicCamera?(e.panLeft(a*(e.object.right-e.object.left)/c.clientWidth),e.panUp(b*(e.object.top-e.object.bottom)/c.clientHeight)):console&&console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(a){void 0===a&&(a=H()),e.object instanceof THREE.PerspectiveCamera?v/=a:e.object instanceof THREE.OrthographicCamera?(e.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*a)),e.object.updateProjectionMatrix(),e.dispatchEvent(D)):console&&console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(a){void 0===a&&(a=H()),e.object instanceof THREE.PerspectiveCamera?v*=a:e.object instanceof THREE.OrthographicCamera?(e.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/a)),e.object.updateProjectionMatrix(),e.dispatchEvent(D)):console&&console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var a=this.object.position;n.copy(a).sub(this.target),n.applyQuaternion(B),r=Math.atan2(n.x,n.z),s=Math.atan2(Math.sqrt(n.x*n.x+n.z*n.z),n.y),this.autoRotate&&A===z.NONE&&this.rotateLeft(G()),r+=u,s+=t,r=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,r)),s=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s)),s=Math.max(f,Math.min(Math.PI-f,s));var b=n.length()*v;b=Math.max(this.minDistance,Math.min(this.maxDistance,b)),d=b,this.target.add(w),n.x=b*Math.sin(s)*Math.sin(r),n.y=b*Math.cos(s),n.z=b*Math.sin(s)*Math.cos(r),n.applyQuaternion(C),a.copy(this.target).add(n),this.object.lookAt(this.target),u=0,t=0,v=1,w.set(0,0,0),(x.distanceToSquared(this.object.position)>f||8*(1-y.dot(this.object.quaternion))>f)&&(this.dispatchEvent(D),x.copy(this.object.position),y.copy(this.object.quaternion))},this.reset=function(){A=z.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(D),this.update()},this.getPolarAngle=function(){return s},this.getAzimuthalAngle=function(){return r},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",I,!1),this.domElement.addEventListener("mousewheel",M,!1),this.domElement.addEventListener("DOMMouseScroll",M,!1),this.domElement.addEventListener("touchstart",O,!1),this.domElement.addEventListener("touchend",Q,!1),this.domElement.addEventListener("touchmove",P,!1),window.addEventListener("keydown",N,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.ColladaLoader=function(){function G(a,b,c,d){var f=0;if(document.implementation&&document.implementation.createDocument){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4===g.readyState){if(0===g.status||200===g.status)if(g.responseXML)e=b,H(g.responseXML,void 0,a);else if(g.responseText){e=b;var h=new DOMParser,i=h.parseFromString(g.responseText,"application/xml");H(i,void 0,a)}else faillCallback?d():console&&console.error("ColladaLoader: Empty or non-existing file ("+a+")")}else 3===g.readyState&&c&&(0===f&&(f=g.getResponseHeader("Content-Length")),c({total:f,loaded:g.responseText.length}))},g.open("GET",a,!0),g.send(null)}else alert("Don't know how to parse XML!")}function H(f,j,o){if(a=f,j=j||e,void 0!==o){var s=o.split("/");s.pop(),x=(s.length<1?".":s.join("/"))+"/"}J(),gb(),g=K("library_images image",ia,"image"),l=K("library_materials material",Ca,"material"),m=K("library_effects effect",Ha,"effect"),k=K("library_geometries geometry",sa,"geometry"),n=K("library_cameras camera",Na,"camera"),p=K("library_lights light",Pa,"light"),i=K("library_controllers controller",ja,"controller"),h=K("library_animations animation",Ja,"animation"),t=K("library_visual_scenes visual_scene",ma,"visual_scene"),u=K("library_kinematics_models kinematics_model",Ra,"kinematics_model"),y=[],z=[],c=L(),b=new THREE.Group;for(var v=0;v<c.nodes.length;v++)b.add(Y(c.nodes[v]));b.scale.multiplyScalar(D),N(),d=M(),X();var w={scene:b,morphs:y,skins:z,animations:q,kinematics:r,dae:{images:g,materials:l,cameras:n,lights:p,effects:m,geometries:k,controllers:i,animations:h,visualScenes:t,visualScene:c,scene:c,kinematicsModels:u,kinematicsModel:d}};return j&&j(w),w}function I(a){B=a}function J(){var b=a.querySelectorAll("asset"),c=b[0];if(c&&c.childNodes)for(var d=0;d<c.childNodes.length;d++){var e=c.childNodes[d];switch(e.nodeName){case"unit":var f=e.getAttribute("meter");f&&(D=parseFloat(f));break;case"up_axis":E=e.textContent.charAt(0)}}}function K(b,c,d){for(var e=a.querySelectorAll(b),f={},g=0,h=e.length,i=0;i<h;i++){var j=e[i],k=(new c).parse(j);k.id&&0!==k.id.length||(k.id=d+g++),f[k.id]=k}return f}function L(){var b=a.querySelectorAll("scene instance_visual_scene")[0];if(b){var c=b.getAttribute("url").replace(/^#/,"");return t[c.length>0?c:"visual_scene0"]}return null}function M(){var b=a.querySelectorAll("instance_kinematics_model")[0];if(b){var c=b.getAttribute("url").replace(/^#/,"");return u[c.length>0?c:"kinematics_model0"]}return null}function N(){q=[],O(b)}function O(a){var b=c.getChildById(a.colladaId,!0),d=null;if(b&&b.keys){d={fps:60,hierarchy:[{node:b,keys:b.keys,sids:b.sids}],node:a,name:"animation_"+a.name,length:0},q.push(d);for(var e=0,f=b.keys.length;e<f;e++)d.length=Math.max(d.length,b.keys[e].time)}else d={hierarchy:[{keys:[],sids:[]}]};for(var e=0,f=a.children.length;e<f;e++)for(var g=O(a.children[e]),h=0,i=g.hierarchy.length;h<i;h++)d.hierarchy.push({keys:[],sids:[]});return d}function P(){var d,a=1e6,b=-a,c=0;for(var e in h){var f=h[e];d=d||f.id;for(var g=0;g<f.sampler.length;g++){var i=f.sampler[g];i.create(),a=Math.min(a,i.startTime),b=Math.max(b,i.endTime),c=Math.max(c,i.input.length)}}return{start:a,end:b,frames:c,ID:d}}function Q(a,b){var c=b instanceof pa?i[b.url]:b;if(!c||!c.morph)return void console&&console.log("could not find morph controller!");for(var d=c.morph,e=0;e<d.targets.length;e++){var f=d.targets[e],g=k[f];if(g.mesh&&g.mesh.primitives&&g.mesh.primitives.length){var h=g.mesh.primitives[0].geometry;h.vertices.length===a.vertices.length&&a.morphTargets.push({name:"target_1",vertices:h.vertices})}}a.morphTargets.push({name:"target_Z",vertices:a.vertices})}function S(a,b,c,d){if(a.world=a.world||new THREE.Matrix4,a.localworld=a.localworld||new THREE.Matrix4,a.world.copy(a.matrix),a.localworld.copy(a.matrix),a.channels&&a.channels.length){var e=a.channels[0],f=e.sampler.output[c];f instanceof THREE.Matrix4&&(a.world.copy(f),a.localworld.copy(f),0===c&&a.matrix.copy(f))}d&&a.world.multiplyMatrices(d,a.world),b.push(a);for(var g=0;g<a.nodes.length;g++)S(a.nodes[g],b,c,a.world)}function T(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=-1;if("JOINT"==d.type){for(var f=0;f<b.joints.length;f++)if(d.sid===b.joints[f]){e=f;break}if(e>=0){var g=b.invBindMatrices[e];d.invBindMatrix=g,d.skinningMatrix=new THREE.Matrix4,d.skinningMatrix.multiplyMatrices(d.world,g),d.animatrix=new THREE.Matrix4,d.animatrix.copy(d.localworld),d.weights=[];for(var f=0;f<b.weights.length;f++)for(var h=0;h<b.weights[f].length;h++){var i=b.weights[f][h];i.joint===e&&d.weights.push(i)}}else console&&console.warn("ColladaLoader: Could not find joint '"+d.sid+"'."),d.skinningMatrix=new THREE.Matrix4,d.weights=[]}}}function U(a){var b=[],c=function(a,b,d){var e={};e.name=b.sid,e.parent=a,e.matrix=b.matrix;var f=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];e.matrix.decompose(f[0],f[1],f[2]),e.pos=[f[0].x,f[0].y,f[0].z],e.scl=[f[2].x,f[2].y,f[2].z],e.rotq=[f[1].x,f[1].y,f[1].z,f[1].w],d.push(e);for(var g in b.nodes)c(b.sid,b.nodes[g],d)};return c(-1,a,b),b}function V(a,b,c){var d=[];S(b,d,-1),T(d,c.skin),v=new THREE.Vector3;for(var e=[],f=0;f<a.vertices.length;f++)e.push(new THREE.Vector3);for(f=0;f<d.length;f++)if("JOINT"==d[f].type)for(j=0;j<d[f].weights.length;j++)w=d[f].weights[j],vidx=w.index,weight=w.weight,o=a.vertices[vidx],s=e[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(d[f].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(var f=0;f<a.vertices.length;f++)a.vertices[f]=e[f]}function W(a,b,d){var e=i[b.url];if(d=void 0!==d?d:40,!e||!e.skin)return void console&&console.log("ColladaLoader: Could not find skin controller.");if(!b.skeleton||!b.skeleton.length)return void console&&console.log("ColladaLoader: Could not find the skeleton for the skin. ");for(var f=P(),g=c.getChildById(b.skeleton[0],!0)||c.getChildBySid(b.skeleton[0],!0),h=U(g),j=e.skin.joints,k=[],l=0;l<j.length;l++)for(var m=0;m<h.length;m++)h[m].name===j[l]&&(k[l]=h[m]);for(var l=0;l<k.length;l++)for(var m=0;m<k.length;m++)k[l].parent===k[m].name&&(k[l].parent=m);var l,m,p;new THREE.Vector3;for(l=0;l<a.vertices.length;l++)a.vertices[l].applyMatrix4(e.skin.bindShapeMatrix);for(var t=[],u=[],v=e.skin.weights,l=0;l<v.length;l++){var w=new THREE.Vector4(v[l][0]?v[l][0].joint:0,v[l][1]?v[l][1].joint:0,v[l][2]?v[l][2].joint:0,v[l][3]?v[l][3].joint:0),p=new THREE.Vector4(v[l][0]?v[l][0].weight:0,v[l][1]?v[l][1].weight:0,v[l][2]?v[l][2].weight:0,v[l][3]?v[l][3].weight:0);t.push(w),u.push(p)}a.skinIndices=t,a.skinWeights=u,a.bones=k;for(var x={name:f.ID,fps:30,length:f.frames/30,hierarchy:[]},m=0;m<k.length;m++)x.hierarchy.push({parent:k[m].parent,name:k[m].name,keys:[]});for(console&&console.log("ColladaLoader:",f.ID+" has "+k.length+" bones."),V(a,g,e),d=0;d<f.frames;d++){var y=[];S(g,y,d),T(y,e.skin);for(var l=0;l<y.length;l++)for(var m=0;m<x.hierarchy.length;m++)if(x.hierarchy[m].name===y[l].sid){var A={};A.time=d/30,A.matrix=y[l].animatrix,0===d&&(y[l].matrix=A.matrix);var B=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];A.matrix.decompose(B[0],B[1],B[2]),A.pos=[B[0].x,B[0].y,B[0].z],A.scl=[B[2].x,B[2].y,B[2].z],A.rot=B[1],x.hierarchy[m].keys.push(A)}a.animation=x}}function X(){if(d&&0===d.joints.length)return void(r=void 0);var e={},f=function(a,f){var g=f.getAttribute("id"),h=c.getChildById(g,!0),i=d.joints[a];b.traverse(function(b){b.colladaId==g&&(e[a]={node:b,transforms:h.transforms,joint:i,position:i.zeroPosition})})};r={joints:d&&d.joints,getJointValue:function(a){var b=e[a];return b?b.position:void console&&console.log("getJointValue: joint "+a+" doesn't exist")},setJointValue:function(a,b){var c=e[a];if(c){var d=c.joint;if(b>d.limits.max||b<d.limits.min)console&&console.log("setJointValue: joint "+a+" value "+b+" outside of limits (min: "+d.limits.min+", max: "+d.limits.max+")");else if(d.static)console&&console.log("setJointValue: joint "+a+" is static");else{var f=c.node,g=d.axis,i=c.transforms,j=new THREE.Matrix4;for(h=0;h<i.length;h++){var k=i[h];if(k.sid&&k.sid.indexOf("joint"+a)!==-1)switch(d.type){case"revolute":j.multiply(l.makeRotationAxis(g,THREE.Math.degToRad(b)));break;case"prismatic":j.multiply(l.makeTranslation(g.x*b,g.y*b,g.z*b));break;default:console&&console.warn("setJointValue: unknown joint type: "+d.type)}else{var l=new THREE.Matrix4;switch(k.type){case"matrix":j.multiply(k.obj);break;case"translate":j.multiply(l.makeTranslation(k.obj.x,k.obj.y,k.obj.z));break;case"rotate":j.multiply(l.makeRotationAxis(k.obj,k.angle))}}}var m=j.elements,n=Array.prototype.slice.call(m),o=[n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]];f.matrix.set.apply(f.matrix,o),f.matrix.decompose(f.position,f.quaternion,f.scale)}}else console&&console.log("setJointValue: joint "+a+" doesn't exist")}};var g=a.querySelector("scene instance_kinematics_scene");if(g)for(var h=0;h<g.childNodes.length;h++){var i=g.childNodes[h];if(1==i.nodeType)switch(i.nodeName){case"bind_joint_axis":var j=i.getAttribute("target").split("/").pop(),k=i.querySelector("axis param").textContent,l=parseInt(k.split("joint").pop().split(".")[0]),m=a.querySelector('[sid="'+j+'"]');if(m){var n=m.parentElement;f(l,n)}}}}function Y(a,b){var e,f,g,h,c=new THREE.Object3D,d=!1;for(g=0;g<a.controllers.length;g++){var j=i[a.controllers[g].url];switch(j.type){case"skin":if(k[j.skin.source]){var o=new ra;o.url=j.skin.source,o.instance_material=a.controllers[g].instance_material,a.geometries.push(o),d=!0,e=a.controllers[g]}else if(i[j.skin.source]){var q=i[j.skin.source];if(f=q,q.morph&&k[q.morph.source]){var o=new ra;o.url=q.morph.source,o.instance_material=a.controllers[g].instance_material,a.geometries.push(o)}}break;case"morph":if(k[j.morph.source]){var o=new ra;o.url=j.morph.source,o.instance_material=a.controllers[g].instance_material,a.geometries.push(o),f=a.controllers[g]}console&&console.log("ColladaLoader: Morph-controller partially supported.")}}var r={};for(g=0;g<a.geometries.length;g++){var A,s=a.geometries[g],t=s.instance_material,u=k[s.url],v={},w=[],x=0;if(u){if(!u.mesh||!u.mesh.primitives)continue;if(0===c.name.length&&(c.name=u.id),t)for(h=0;h<t.length;h++){var B=t[h],D=l[B.target],E=D.instance_effect.url,F=m[E].shader,G=F.material;if(u.doubleSided){if(!(B.symbol in r)){var H=G.clone();H.side=THREE.DoubleSide,r[B.symbol]=H}G=r[B.symbol]}G.opacity=G.opacity?G.opacity:1,v[B.symbol]=x,w.push(G),A=G,A.name=null===D.name||""===D.name?D.id:D.name,x++}var I,J=A||new THREE.MeshLambertMaterial({color:14540253,side:u.doubleSided?THREE.DoubleSide:THREE.FrontSide}),K=u.mesh.geometry3js;if(x>1)for(J=new THREE.MeshFaceMaterial(w),h=0;h<K.faces.length;h++){var L=K.faces[h];L.materialIndex=v[L.daeMaterial]}void 0!==e?(W(K,e),K.morphTargets.length>0?(J.morphTargets=!0,J.skinning=!1):(J.morphTargets=!1,J.skinning=!0),I=new THREE.SkinnedMesh(K,J,!1),I.name="skin_"+z.length,z.push(I)):void 0!==f?(Q(K,f),J.morphTargets=!0,I=new THREE.Mesh(K,J),I.name="morph_"+y.length,y.push(I)):I=K.isLineStrip===!0?new THREE.Line(K):new THREE.Mesh(K,J),c.add(I)}}for(g=0;g<a.cameras.length;g++){var M=a.cameras[g],N=n[M.url],O=new THREE.PerspectiveCamera(N.yfov,parseFloat(N.aspect_ratio),parseFloat(N.znear),parseFloat(N.zfar));c.add(O)}for(g=0;g<a.lights.length;g++){var P=null,R=a.lights[g],S=p[R.url];if(S&&S.technique){var Z,T=S.color.getHex(),U=S.intensity,V=S.distance,X=S.falloff_angle;switch(S.technique){case"directional":P=new THREE.DirectionalLight(T,U,V),P.position.set(0,0,1);break;case"point":P=new THREE.PointLight(T,U,V);break;case"spot":P=new THREE.SpotLight(T,U,V,X,Z),P.position.set(0,0,1);break;case"ambient":P=new THREE.AmbientLight(T)}}P&&c.add(P)}if(c.name=a.name||a.id||"",c.colladaId=a.id||"",c.layer=a.layer||"",c.matrix=a.matrix,c.matrix.decompose(c.position,c.quaternion,c.scale),C.centerGeometry&&c.geometry){var $=c.geometry.center();$.multiply(c.scale),$.applyQuaternion(c.quaternion),c.position.sub($)}for(g=0;g<a.nodes.length;g++)c.add(Y(a.nodes[g],a));return c}function $(b){for(var c=a.querySelectorAll("library_nodes node"),d=0;d<c.length;d++){var e=c[d].attributes.getNamedItem("id");if(e&&e.value===b)return c[d]}}function _(a){var b=[],c=1e6,d=-1e6;for(var e in h)for(var f=h[e],g=0;g<f.channel.length;g++){var i=f.channel[g],j=f.sampler[g],e=i.target.split("/")[0];e==a.id&&(j.create(),i.sampler=j,c=Math.min(c,j.startTime),d=Math.max(d,j.endTime),b.push(i))}return b.length&&(a.startTime=c,a.endTime=d),b}function ca(a){if(a.channels&&a.channels.length){for(var b=[],c=[],d=0,e=a.channels.length;d<e;d++){var k,f=a.channels[d],g=f.fullSid,h=f.sampler,i=h.input,j=a.getTransformBySid(f.sid);if(f.arrIndices){k=[];for(var l=0,m=f.arrIndices.length;l<m;l++)k[l]=lb(f.arrIndices[l])}else k=mb(f.member);if(j){c.indexOf(g)===-1&&c.push(g);for(var l=0,m=i.length;l<m;l++){var n=i[l],o=h.getData(j.type,l,k),p=da(b,n);if(!p){p=new Ma(n);var q=ea(b,n);b.splice(q===-1?b.length:q,0,p)}p.addTarget(g,j,k,o)}}else console&&console.log('Could not find transform "'+f.sid+'" in node '+a.id)}for(var d=0;d<c.length;d++)for(var r=c[d],l=0;l<b.length;l++){var p=b[l];p.hasTarget(r)||fa(b,p,l,r)}a.keys=b,a.sids=c}}function da(a,b){for(var c=null,d=0,e=a.length;d<e&&null===c;d++){var f=a[d];if(f.time===b)c=f;else if(f.time>b)break}return c}function ea(a,b){for(var c=-1,d=0,e=a.length;d<e&&c===-1;d++){var f=a[d];f.time>=b&&(c=d)}return c}function fa(a,b,c,d){var e=ha(a,d,c?c-1:0),f=ga(a,d,c+1);if(e&&f){var k,g=(b.time-e.time)/(f.time-e.time),h=e.getTarget(d),i=f.getTarget(d).data,j=h.data;if("matrix"===h.type)k=j;else if(j.length){k=[];for(var l=0;l<j.length;++l)k[l]=j[l]+(i[l]-j[l])*g}else k=j+(i-j)*g;b.addTarget(d,h.transform,h.member,k)}}function ga(a,b,c){for(;c<a.length;c++){var d=a[c];if(d.hasTarget(b))return d}return null}function ha(a,b,c){for(c=c>=0?c:c+a.length;c>=0;c--){var d=a[c];if(d.hasTarget(b))return d}return null}function ia(){this.id="",this.init_from=""}function ja(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function ka(){this.method=null,this.source=null,this.targets=null,this.weights=null}function la(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function ma(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Group}function na(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function oa(){this.sid="",this.type="",this.data=[],this.obj=null}function pa(){this.url="",this.skeleton=[],this.instance_material=[]}function qa(){this.symbol="",this.target=""}function ra(){this.url="",this.instance_material=[]}function sa(){this.id="",this.mesh=null}function ta(a){this.geometry=a.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function ua(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function va(){ua.call(this),this.vcount=[]}function wa(){ua.call(this),this.vcount=1}function xa(){ua.call(this),this.vcount=3}function ya(){this.source="",this.count=0,this.stride=0,this.params=[]}function za(){this.input={}}function Aa(){this.semantic="",this.offset=0,this.source="",this.set=0}function Ba(a){this.id=a,this.type=null}function Ca(){this.id="",this.name="",this.instance_effect=null}function Da(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function Ea(a,b){this.type=a,this.effect=b,this.material=null}function Fa(a){this.effect=a,this.init_from=null,this.format=null}function Ga(a){this.effect=a,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function Ha(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function Ia(){this.url=""}function Ja(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function Ka(a){this.animation=a,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function La(a){this.id="",this.animation=a,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function Ma(a){this.targets=[],this.time=a}function Na(){this.id="",this.name="",this.technique=""}function Oa(){this.url=""}function Pa(){this.id="",this.name="",this.technique=""}function Qa(){this.url=""}function Ra(){this.id="",this.name="",this.joints=[],this.links=[]}function Sa(){this.sid="",this.name="",this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function Ta(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function Ua(){this.joint="",this.transforms=[],this.links=[]}function Va(a){var b=a.getAttribute("id");return void 0!=f[b]?f[b]:(f[b]=new Ba(b).parse(a),f[b])}function Xa(a){for(var b=$a(a),c=[],d=0,e=b.length;d<e;d++)c.push("true"===b[d]||"1"===b[d]);return c}function Ya(a){for(var b=$a(a),c=[],d=0,e=b.length;d<e;d++)c.push(parseFloat(b[d]));return c}function Za(a){for(var b=$a(a),c=[],d=0,e=b.length;d<e;d++)c.push(parseInt(b[d],10));return c}function $a(a){return a.length>0?_a(a).split(/\s+/):[]}function _a(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function bb(a,b,c){return a.hasAttribute(b)?parseInt(a.getAttribute(b),10):c}function eb(a,b){loader=new THREE.ImageLoader,loader.load(b,function(b){a.image=b,a.needsUpdate=!0})}function fb(a,b){a.doubleSided=!1;var c=b.querySelectorAll("extra double_sided")[0];c&&c&&1===parseInt(c.textContent,10)&&(a.doubleSided=!0)}function gb(){if(C.convertUpAxis!==!0||E===C.upAxis)F=null;else switch(E){case"X":F="Y"===C.upAxis?"XtoY":"XtoZ";break;case"Y":F="X"===C.upAxis?"YtoX":"YtoZ";break;case"Z":F="X"===C.upAxis?"ZtoX":"ZtoY"}}function hb(a,b){if(C.convertUpAxis===!0&&E!==C.upAxis)switch(F){case"XtoY":var c=a[0];a[0]=b*a[1],a[1]=c;break;case"XtoZ":var c=a[2];a[2]=a[1],a[1]=a[0],a[0]=c;break;case"YtoX":var c=a[0];a[0]=a[1],a[1]=b*c;break;case"YtoZ":var c=a[1];a[1]=b*a[2],a[2]=c;break;case"ZtoX":var c=a[0];a[0]=a[1],a[1]=a[2],a[2]=c;break;case"ZtoY":var c=a[1];a[1]=a[2],a[2]=b*c}}function ib(a,b){if(C.convertUpAxis!==!0||E===C.upAxis)return b;switch(a){case"X":b="XtoY"===F?b*-1:b;break;case"Y":b="YtoZ"===F||"YtoX"===F?b*-1:b;break;case"Z":b="ZtoY"===F?b*-1:b}return b}function jb(a,b){var c=[a[b],a[b+1],a[b+2]];return hb(c,-1),new THREE.Vector3(c[0],c[1],c[2])}function kb(a){if(C.convertUpAxis){var b=[a[0],a[4],a[8]];hb(b,-1),a[0]=b[0],a[4]=b[1],a[8]=b[2],b=[a[1],a[5],a[9]],hb(b,-1),a[1]=b[0],a[5]=b[1],a[9]=b[2],b=[a[2],a[6],a[10]],hb(b,-1),a[2]=b[0],a[6]=b[1],a[10]=b[2],b=[a[0],a[1],a[2]],hb(b,-1),a[0]=b[0],a[1]=b[1],a[2]=b[2],b=[a[4],a[5],a[6]],hb(b,-1),a[4]=b[0],a[5]=b[1],a[6]=b[2],b=[a[8],a[9],a[10]],hb(b,-1),a[8]=b[0],a[9]=b[1],a[10]=b[2],b=[a[3],a[7],a[11]],hb(b,-1),a[3]=b[0],a[7]=b[1],a[11]=b[2]}return(new THREE.Matrix4).set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function lb(a){if(a>-1&&a<3){var b=["X","Y","Z"],c={X:0,Y:1,Z:2};a=mb(b[a]),a=c[a]}return a}function mb(a){if(C.convertUpAxis)switch(a){case"X":switch(F){case"XtoY":case"XtoZ":case"YtoX":a="Y";break;case"ZtoX":a="Z"}break;case"Y":switch(F){case"XtoY":case"YtoX":case"ZtoX":a="X";break;case"XtoZ":case"YtoZ":case"ZtoY":a="Z"}break;case"Z":switch(F){case"XtoZ":a="X";break;case"YtoZ":case"ZtoX":case"ZtoY":a="Y"}}return a}var c,d,q,r,t,u,x,y,z,a=null,b=null,e=null,f={},g={},h={},i={},k={},l={},m={},n={},p={},B=THREE.SmoothShading,C={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},D=1,E="Y",F=null;return ia.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];"init_from"===c.nodeName&&(this.init_from=c.textContent)}return this},ja.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type="none";for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"skin":this.skin=(new la).parse(c),this.type=c.nodeName;break;case"morph":this.morph=(new ka).parse(c),this.type=c.nodeName}}return this},ka.prototype.parse=function(a){var d,b={},c=[];for(this.method=a.getAttribute("method"),this.source=a.getAttribute("source").replace(/^#/,""),d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(1==e.nodeType)switch(e.nodeName){case"source":var f=(new Ba).parse(e);b[f.id]=f;break;case"targets":c=this.parseInputs(e);break;default:console&&console.log(e.nodeName)}}for(d=0;d<c.length;d++){var g=c[d],f=b[g.source];switch(g.semantic){case"MORPH_TARGET":this.targets=f.read();break;case"MORPH_WEIGHT":this.weights=f.read()}}return this},ka.prototype.parseInputs=function(a){for(var b=[],c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"input":b.push((new Aa).parse(d))}}return b},la.prototype.parse=function(a){var c,d,b={};this.source=a.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var e=0;e<a.childNodes.length;e++){var f=a.childNodes[e];if(1==f.nodeType)switch(f.nodeName){case"bind_shape_matrix":var g=Ya(f.textContent);this.bindShapeMatrix=kb(g);break;case"source":var h=(new Ba).parse(f);b[h.id]=h;break;case"joints":c=f;break;case"vertex_weights":d=f;break;default:console&&console.log(f.nodeName)}}return this.parseJoints(c,b),this.parseWeights(d,b),this},la.prototype.parseJoints=function(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"input":var e=(new Aa).parse(d),f=b[e.source];"JOINT"===e.semantic?this.joints=f.read():"INV_BIND_MATRIX"===e.semantic&&(this.invBindMatrices=f.read())}}},la.prototype.parseWeights=function(a,b){for(var c,d,e=[],f=0;f<a.childNodes.length;f++){var g=a.childNodes[f];if(1==g.nodeType)switch(g.nodeName){case"input":e.push((new Aa).parse(g));break;case"v":c=Za(g.textContent);break;case"vcount":d=Za(g.textContent)}}for(var h=0,f=0;f<d.length;f++){for(var i=d[f],j=[],k=0;k<i;k++){for(var l={},m=0;m<e.length;m++){var n=e[m],o=c[h+n.offset];switch(n.semantic){case"JOINT":l.joint=o;break;case"WEIGHT":l.weight=b[n.source].data[o]}}j.push(l),h+=e.length}for(var k=0;k<j.length;k++)j[k].index=f;this.weights.push(j)}},ma.prototype.getChildById=function(a,b){for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildById(a,b);if(d)return d}return null},ma.prototype.getChildBySid=function(a,b){for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildBySid(a,b);if(d)return d}return null},ma.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.nodes=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"node":this.nodes.push((new na).parse(c))}}return this},na.prototype.getChannelForTransform=function(a){for(var b=0;b<this.channels.length;b++){var i,j,c=this.channels[b],d=c.target.split("/"),f=(d.shift(),d.shift()),g=f.indexOf(".")>=0,h=f.indexOf("(")>=0;if(g)d=f.split("."),f=d.shift(),j=d.shift();else if(h){i=f.split("("),f=i.shift();for(var k=0;k<i.length;k++)i[k]=parseInt(i[k].replace(/\)/,""))}if(f===a)return c.info={sid:f,dotSyntax:g,arrSyntax:h,arrIndices:i},c}return null},na.prototype.getChildById=function(a,b){if(this.id===a)return this;if(b)for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildById(a,b);if(d)return d}return null},na.prototype.getChildBySid=function(a,b){if(this.sid===a)return this;if(b)for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildBySid(a,b);if(d)return d}return null},na.prototype.getTransformBySid=function(a){for(var b=0;b<this.transforms.length;b++)if(this.transforms[b].sid===a)return this.transforms[b];return null},na.prototype.parse=function(a){var b;this.id=a.getAttribute("id"),this.sid=a.getAttribute("sid"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.layer=a.getAttribute("layer"),
this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"node":this.nodes.push((new na).parse(d));break;case"instance_camera":this.cameras.push((new Oa).parse(d));break;case"instance_controller":this.controllers.push((new pa).parse(d));break;case"instance_geometry":this.geometries.push((new ra).parse(d));break;case"instance_light":this.lights.push((new Qa).parse(d));break;case"instance_node":b=d.getAttribute("url").replace(/^#/,"");var e=$(b);e&&this.nodes.push((new na).parse(e));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new oa).parse(d));break;case"extra":break;default:console&&console.log(d.nodeName)}}return this.channels=_(this),ca(this),this.updateMatrix(),this},na.prototype.updateMatrix=function(){this.matrix.identity();for(var a=0;a<this.transforms.length;a++)this.transforms[a].apply(this.matrix)},oa.prototype.parse=function(a){return this.sid=a.getAttribute("sid"),this.type=a.nodeName,this.data=Ya(a.textContent),this.convert(),this},oa.prototype.convert=function(){switch(this.type){case"matrix":this.obj=kb(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":hb(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":hb(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console&&console.log("Can not convert Transform of type "+this.type)}},oa.prototype.apply=function(){var a=new THREE.Matrix4;return function(b){switch(this.type){case"matrix":b.multiply(this.obj);break;case"translate":b.multiply(a.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":b.multiply(a.makeRotationAxis(this.obj,this.angle));break;case"scale":b.scale(this.obj)}}}(),oa.prototype.update=function(a,b){var c=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(b)if(1===b.length)switch(b[0]){case 0:this.obj.n11=a[0],this.obj.n21=a[1],this.obj.n31=a[2],this.obj.n41=a[3];break;case 1:this.obj.n12=a[0],this.obj.n22=a[1],this.obj.n32=a[2],this.obj.n42=a[3];break;case 2:this.obj.n13=a[0],this.obj.n23=a[1],this.obj.n33=a[2],this.obj.n43=a[3];break;case 3:this.obj.n14=a[0],this.obj.n24=a[1],this.obj.n34=a[2],this.obj.n44=a[3]}else if(2===b.length){var d="n"+(b[0]+1)+(b[1]+1);this.obj[d]=a}else console&&console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(a);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]),b){case"X":this.obj.x=a;break;case"Y":this.obj.y=a;break;case"Z":this.obj.z=a;break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]),b){case"X":this.obj.x=a;break;case"Y":this.obj.y=a;break;case"Z":this.obj.z=a;break;case"ANGLE":this.angle=THREE.Math.degToRad(a);break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2],this.angle=THREE.Math.degToRad(a[3])}}},pa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1===c.nodeType)switch(c.nodeName){case"skeleton":this.skeleton.push(c.textContent.replace(/^#/,""));break;case"bind_material":for(var d=c.querySelectorAll("instance_material"),e=0;e<d.length;e++){var f=d[e];this.instance_material.push((new qa).parse(f))}break;case"extra":}}return this},qa.prototype.parse=function(a){return this.symbol=a.getAttribute("symbol"),this.target=a.getAttribute("target").replace(/^#/,""),this},ra.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType&&"bind_material"===c.nodeName){for(var d=c.querySelectorAll("instance_material"),e=0;e<d.length;e++){var f=d[e];this.instance_material.push((new qa).parse(f))}break}}return this},sa.prototype.parse=function(a){this.id=a.getAttribute("id"),fb(this,a);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"mesh":this.mesh=new ta(this).parse(c);break;case"extra":}}return this},ta.prototype.parse=function(a){this.primitives=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"source":Va(c);break;case"vertices":this.vertices=(new za).parse(c);break;case"linestrips":this.primitives.push((new wa).parse(c));break;case"triangles":this.primitives.push((new xa).parse(c));break;case"polygons":this.primitives.push((new ua).parse(c));break;case"polylist":this.primitives.push((new va).parse(c))}}if(this.geometry3js=new THREE.Geometry,null===this.vertices)return this;for(var d=f[this.vertices.input.POSITION.source].data,b=0;b<d.length;b+=3)this.geometry3js.vertices.push(jb(d,b).clone());for(var b=0;b<this.primitives.length;b++){var e=this.primitives[b];e.setVertices(this.vertices),this.handlePrimitive(e,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},ta.prototype.handlePrimitive=function(a,b){if(a instanceof wa)return void(b.isLineStrip=!0);var c,d,h,i,j,k,l,e=a.p,g=a.inputs,m=0,n=3,o=0,p=[];for(c=0;c<g.length;c++){h=g[c];var q=h.offset+1;switch(o=o<q?q:o,h.semantic){case"TEXCOORD":p.push(h.set)}}for(var r=0;r<e.length;++r)for(var s=e[r],t=0;t<s.length;){var u=[],v=[],w=null,x=[];for(n=a.vcount?a.vcount.length?a.vcount[m++]:a.vcount:s.length/o,c=0;c<n;c++)for(d=0;d<g.length;d++)switch(h=g[d],k=f[h.source],i=s[t+c*o+h.offset],l=k.accessor.params.length,j=i*l,h.semantic){case"VERTEX":u.push(i);break;case"NORMAL":v.push(jb(k.data,j));break;case"TEXCOORD":w=w||{},void 0===w[h.set]&&(w[h.set]=[]),w[h.set].push(new THREE.Vector2(k.data[j],k.data[j+1]));break;case"COLOR":x.push((new THREE.Color).setRGB(k.data[j],k.data[j+1],k.data[j+2]))}if(0===v.length)if(h=this.vertices.input.NORMAL){k=f[h.source],l=k.accessor.params.length;for(var y=0,z=u.length;y<z;y++)v.push(jb(k.data,u[y]*l))}else b.calcNormals=!0;if(!w&&(w={},h=this.vertices.input.TEXCOORD)){p.push(h.set),k=f[h.source],l=k.accessor.params.length;for(var y=0,z=u.length;y<z;y++)j=u[y]*l,void 0===w[h.set]&&(w[h.set]=[]),w[h.set].push(new THREE.Vector2(k.data[j],1-k.data[j+1]))}if(0===x.length&&(h=this.vertices.input.COLOR)){k=f[h.source],l=k.accessor.params.length;for(var y=0,z=u.length;y<z;y++)j=u[y]*l,x.push((new THREE.Color).setRGB(k.data[j],k.data[j+1],k.data[j+2]))}var D,E,A=null,B=[];if(3===n)B.push(new THREE.Face3(u[0],u[1],u[2],v,x.length?x:new THREE.Color));else if(4===n)B.push(new THREE.Face3(u[0],u[1],u[3],[v[0].clone(),v[1].clone(),v[3].clone()],x.length?[x[0],x[1],x[3]]:new THREE.Color)),B.push(new THREE.Face3(u[1],u[2],u[3],[v[1].clone(),v[2].clone(),v[3].clone()],x.length?[x[1],x[2],x[3]]:new THREE.Color));else if(n>4&&C.subdivideFaces){var F=x.length?x:new THREE.Color;for(d=1;d<n-1;)B.push(new THREE.Face3(u[0],u[d],u[d+1],[v[0].clone(),v[d++].clone(),v[d].clone()],F))}if(B.length)for(var y=0,z=B.length;y<z;y++)for(A=B[y],A.daeMaterial=a.material,b.faces.push(A),d=0;d<p.length;d++)D=w[p[d]],E=n>4?[D[0],D[y+1],D[y+2]]:4===n?0===y?[D[0],D[1],D[3]]:[D[1].clone(),D[2],D[3].clone()]:[D[0],D[1],D[2]],void 0===b.faceVertexUvs[d]&&(b.faceVertexUvs[d]=[]),b.faceVertexUvs[d].push(E);else console&&console.log("dropped face with vcount "+n+" for geometry with id: "+b.id);t+=o*n}},ua.prototype.setVertices=function(a){for(var b=0;b<this.inputs.length;b++)this.inputs[b].source===a.id&&(this.inputs[b].source=a.input.POSITION.source)},ua.prototype.parse=function(a){this.material=a.getAttribute("material"),this.count=bb(a,"count",0);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"input":this.inputs.push((new Aa).parse(a.childNodes[b]));break;case"vcount":this.vcount=Za(c.textContent);break;case"p":this.p.push(Za(c.textContent));break;case"ph":console&&console.warn("polygon holes not yet supported!")}}return this},va.prototype=Object.create(ua.prototype),va.prototype.constructor=va,wa.prototype=Object.create(ua.prototype),wa.prototype.constructor=wa,xa.prototype=Object.create(ua.prototype),xa.prototype.constructor=xa,ya.prototype.parse=function(a){this.params=[],this.source=a.getAttribute("source"),this.count=bb(a,"count",0),this.stride=bb(a,"stride",0);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if("param"===c.nodeName){var d={};d.name=c.getAttribute("name"),d.type=c.getAttribute("type"),this.params.push(d)}}return this},za.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++)if("input"===a.childNodes[b].nodeName){var c=(new Aa).parse(a.childNodes[b]);this.input[c.semantic]=c}return this},Aa.prototype.parse=function(a){return this.semantic=a.getAttribute("semantic"),this.source=a.getAttribute("source").replace(/^#/,""),this.set=bb(a,"set",-1),this.offset=bb(a,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},Ba.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"bool_array":this.data=Xa(c.textContent),this.type=c.nodeName;break;case"float_array":this.data=Ya(c.textContent),this.type=c.nodeName;break;case"int_array":this.data=Za(c.textContent),this.type=c.nodeName;break;case"IDREF_array":case"Name_array":this.data=$a(c.textContent),this.type=c.nodeName;break;case"technique_common":for(var d=0;d<c.childNodes.length;d++)if("accessor"===c.childNodes[d].nodeName){this.accessor=(new ya).parse(c.childNodes[d]);break}}}return this},Ba.prototype.read=function(){var a=[],b=this.accessor.params[0];switch(b.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var c=0;c<this.data.length;c+=16){var d=this.data.slice(c,c+16),e=kb(d);a.push(e)}break;default:console&&console.log("ColladaLoader: Source: Read dont know how to read "+b.type+".")}return a},Ca.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++)if("instance_effect"===a.childNodes[b].nodeName){this.instance_effect=(new Ia).parse(a.childNodes[b]);break}return this},Da.prototype.isColor=function(){return null===this.texture},Da.prototype.isTexture=function(){return null!=this.texture},Da.prototype.parse=function(a){"transparent"===a.nodeName&&(this.opaque=a.getAttribute("opaque"));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"color":var d=Ya(c.textContent);this.color=new THREE.Color,this.color.setRGB(d[0],d[1],d[2]),this.color.a=d[3];break;case"texture":this.texture=c.getAttribute("texture"),this.texcoord=c.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(c)}}return this},Da.prototype.parseTexture=function(a){if(!a.childNodes)return this;a.childNodes[1]&&"extra"===a.childNodes[1].nodeName&&(a=a.childNodes[1],a.childNodes[1]&&"technique"===a.childNodes[1].nodeName&&(a=a.childNodes[1]));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[c.nodeName]=parseFloat(c.textContent);break;case"wrapU":case"wrapV":"TRUE"===c.textContent.toUpperCase()?this.texOpts[c.nodeName]=1:this.texOpts[c.nodeName]=parseInt(c.textContent);break;default:this.texOpts[c.nodeName]=c.textContent}}return this},Ea.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[c.nodeName]=(new Da).parse(c);break;case"bump":var d=c.getAttribute("bumptype");d?"heightfield"===d.toLowerCase()?this.bump=(new Da).parse(c):"normalmap"===d.toLowerCase()?this.normal=(new Da).parse(c):(console&&console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+d+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new Da).parse(c)):(console&&console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new Da).parse(c));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var e=c.querySelectorAll("float");e.length>0&&(this[c.nodeName]=parseFloat(e[0].textContent))}}return this.create(),this},Ea.prototype.create=function(){var a={},b=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var d=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);d>0&&(b=!0,a.transparent=!0,a.opacity=1-d)}var e={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var f in this)switch(f){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var h=this[f];if(h instanceof Da)if(h.isTexture()){var i=h.texture,j=this.effect.sampler[i];if(void 0!==j&&void 0!==j.source){var k=this.effect.surface[j.source];if(void 0!==k){var l=g[k.init_from];if(l){var n,m=x+l.init_from,o=THREE.Loader.Handlers.get(m);null!==o?n=o.load(m):(n=new THREE.Texture,eb(n,m)),n.wrapS=h.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=h.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.offset.x=h.texOpts.offsetU,n.offset.y=h.texOpts.offsetV,n.repeat.x=h.texOpts.repeatU,n.repeat.y=h.texOpts.repeatV,a[e[f]]=n,"emission"===f&&(a.emissive=16777215)}}}}else"diffuse"!==f&&b||("emission"===f?a.emissive=h.color.getHex():a[f]=h.color.getHex());break;case"shininess":a[f]=this[f];break;case"reflectivity":a[f]=this[f],a[f]>0&&(a.envMap=C.defaultEnvMap),a.combine=THREE.MixOperation;break;case"index_of_refraction":a.refractionRatio=this[f],1!==this[f]&&(a.envMap=C.defaultEnvMap);break;case"transparency":}switch(a.shading=B,a.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":void 0!=a.emissive&&(a.color=a.emissive),this.material=new THREE.MeshBasicMaterial(a);break;case"phong":case"blinn":void 0!=a.diffuse&&(a.color=a.diffuse),this.material=new THREE.MeshPhongMaterial(a);break;case"lambert":default:void 0!=a.diffuse&&(a.color=a.diffuse),this.material=new THREE.MeshLambertMaterial(a)}return this.material},Fa.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"init_from":this.init_from=c.textContent;break;case"format":this.format=c.textContent;break;default:console&&console.log("unhandled Surface prop: "+c.nodeName)}}return this},Ga.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"source":this.source=c.textContent;break;case"minfilter":this.minfilter=c.textContent;break;case"magfilter":this.magfilter=c.textContent;break;case"mipfilter":this.mipfilter=c.textContent;break;case"wrap_s":this.wrap_s=c.textContent;break;case"wrap_t":this.wrap_t=c.textContent;break;default:console&&console.log("unhandled Sampler2D prop: "+c.nodeName)}}return this},Ha.prototype.create=function(){if(null===this.shader)return null},Ha.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),fb(this,a),this.shader=null;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(c))}}return this},Ha.prototype.parseNewparam=function(a){for(var b=a.getAttribute("sid"),c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"surface":this.surface[b]=new Fa(this).parse(d);break;case"sampler2D":this.sampler[b]=new Ga(this).parse(d);break;case"extra":break;default:console&&console.log(d.nodeName)}}},Ha.prototype.parseProfileCOMMON=function(a){for(var b,c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"profile_COMMON":this.parseProfileCOMMON(d);break;case"technique":b=d;break;case"newparam":this.parseNewparam(d);break;case"image":var e=(new ia).parse(d);g[e.id]=e;break;case"extra":break;default:console&&console.log(d.nodeName)}}return b},Ha.prototype.parseTechnique=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new Ea(c.nodeName,this).parse(c);break;case"extra":this.parseExtra(c)}}},Ha.prototype.parseExtra=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique":this.parseExtraTechnique(c)}}},Ha.prototype.parseExtraTechnique=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"bump":this.shader.parse(a)}}},Ia.prototype.parse=function(a){return this.url=a.getAttribute("url").replace(/^#/,""),this},Ja.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.source={};for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"animation":var d=(new Ja).parse(c);for(var e in d.source)this.source[e]=d.source[e];for(var f=0;f<d.channel.length;f++)this.channel.push(d.channel[f]),this.sampler.push(d.sampler[f]);break;case"source":var e=(new Ba).parse(c);this.source[e.id]=e;break;case"sampler":this.sampler.push(new La(this).parse(c));break;case"channel":this.channel.push(new Ka(this).parse(c))}}return this},Ka.prototype.parse=function(a){this.source=a.getAttribute("source").replace(/^#/,""),this.target=a.getAttribute("target");var b=this.target.split("/"),d=(b.shift(),b.shift()),e=d.indexOf(".")>=0,f=d.indexOf("(")>=0;if(e)b=d.split("."),this.sid=b.shift(),this.member=b.shift();else if(f){var g=d.split("(");this.sid=g.shift();for(var h=0;h<g.length;h++)g[h]=parseInt(g[h].replace(/\)/,""));this.arrIndices=g}else this.sid=d;return this.fullSid=d,this.dotSyntax=e,this.arrSyntax=f,this},La.prototype.parse=function(a){this.id=a.getAttribute("id"),this.inputs=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"input":this.inputs.push((new Aa).parse(c))}}return this},La.prototype.create=function(){for(var a=0;a<this.inputs.length;a++){var b=this.inputs[a],c=this.animation.source[b.source];switch(b.semantic){case"INPUT":this.input=c.read();break;case"OUTPUT":this.output=c.read(),this.strideOut=c.accessor.stride;break;case"INTERPOLATION":this.interpolation=c.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console&&console.log(b.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var a=0;a<this.input.length;a++)this.startTime=Math.min(this.startTime,this.input[a]),this.endTime=Math.max(this.endTime,this.input[a]);this.duration=this.endTime-this.startTime}},La.prototype.getData=function(a,b,c){var d;if("matrix"===a&&16===this.strideOut)d=this.output[b];else if(this.strideOut>1){d=[],b*=this.strideOut;for(var e=0;e<this.strideOut;++e)d[e]=this.output[b+e];if(3===this.strideOut)switch(a){case"rotate":case"translate":hb(d,-1);break;case"scale":hb(d,1)}else 4===this.strideOut&&"matrix"===a&&hb(d,-1)}else d=this.output[b],c&&"translate"===a&&(d=ib(c,d));return d},Ma.prototype.addTarget=function(a,b,c,d){this.targets.push({sid:a,member:c,transform:b,data:d})},Ma.prototype.apply=function(a){for(var b=0;b<this.targets.length;++b){var c=this.targets[b];a&&c.sid!==a||c.transform.update(c.data,c.member)}},Ma.prototype.getTarget=function(a){for(var b=0;b<this.targets.length;++b)if(this.targets[b].sid===a)return this.targets[b];return null},Ma.prototype.hasTarget=function(a){for(var b=0;b<this.targets.length;++b)if(this.targets[b].sid===a)return!0;return!1},Ma.prototype.interpolate=function(a,b){for(var c=0,d=this.targets.length;c<d;c++){var g,e=this.targets[c],f=a.getTarget(e.sid);if("matrix"!==e.transform.type&&f){var h=(b-this.time)/(a.time-this.time),i=f.data,j=e.data;if(h<0&&(h=0),h>1&&(h=1),j.length){g=[];for(var k=0;k<j.length;++k)g[k]=j[k]+(i[k]-j[k])*h}else g=j+(i-j)*h}else g=e.data;e.transform.update(g,e.member)}},Na.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"optics":this.parseOptics(c)}}return this},Na.prototype.parseOptics=function(a){for(var b=0;b<a.childNodes.length;b++)if("technique_common"===a.childNodes[b].nodeName)for(var c=a.childNodes[b],d=0;d<c.childNodes.length;d++)if(this.technique=c.childNodes[d].nodeName,"perspective"===this.technique)for(var e=c.childNodes[d],f=0;f<e.childNodes.length;f++){var g=e.childNodes[f];switch(g.nodeName){case"yfov":this.yfov=g.textContent;break;case"xfov":this.xfov=g.textContent;break;case"znear":this.znear=g.textContent;break;case"zfar":this.zfar=g.textContent;break;case"aspect_ratio":this.aspect_ratio=g.textContent}}else if("orthographic"===this.technique)for(var h=c.childNodes[d],f=0;f<h.childNodes.length;f++){var g=h.childNodes[f];switch(g.nodeName){case"xmag":this.xmag=g.textContent;break;case"ymag":this.ymag=g.textContent;break;case"znear":this.znear=g.textContent;break;case"zfar":this.zfar=g.textContent;break;case"aspect_ratio":this.aspect_ratio=g.textContent}}return this},Oa.prototype.parse=function(a){return this.url=a.getAttribute("url").replace(/^#/,""),this},Pa.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique_common":this.parseCommon(c);break;case"technique":this.parseTechnique(c)}}return this},Pa.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++)switch(a.childNodes[b].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=a.childNodes[b].nodeName;for(var c=a.childNodes[b],d=0;d<c.childNodes.length;d++){var e=c.childNodes[d];switch(e.nodeName){case"color":var f=Ya(e.textContent);this.color=new THREE.Color(0),this.color.setRGB(f[0],f[1],f[2]),this.color.a=f[3];break;case"falloff_angle":this.falloff_angle=parseFloat(e.textContent);break;case"quadratic_attenuation":var g=parseFloat(e.textContent);this.distance=g?Math.sqrt(1/g):0}}}return this},Pa.prototype.parseTechnique=function(a){this.profile=a.getAttribute("profile");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"intensity":this.intensity=parseFloat(c.textContent)}}return this},Qa.prototype.parse=function(a){return this.url=a.getAttribute("url").replace(/^#/,""),this},Ra.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.joints=[],this.links=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique_common":this.parseCommon(c)}}return this},Ra.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(a.childNodes[b].nodeName){case"joint":this.joints.push((new Sa).parse(c));break;case"link":this.links.push((new Ta).parse(c))}}return this},Sa.prototype.parse=function(a){this.sid=a.getAttribute("sid"),this.name=a.getAttribute("name"),this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var b=a.querySelector("axis"),c=Ya(b.textContent);this.axis=jb(c,0);var d=a.querySelector("limits min")?parseFloat(a.querySelector("limits min").textContent):-360,e=a.querySelector("limits max")?parseFloat(a.querySelector("limits max").textContent):360;this.limits={min:d,max:e};for(var f=["prismatic","revolute"],g=0;g<f.length;g++){var h=f[g],i=a.querySelector(h);i&&(this.type=h)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},Ta.prototype.parse=function(a){this.sid=a.getAttribute("sid"),this.name=a.getAttribute("name"),this.transforms=[],this.attachments=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"attachment_full":this.attachments.push((new Ua).parse(c));break;case"rotate":case"translate":case"matrix":this.transforms.push((new oa).parse(c))}}return this},Ua.prototype.parse=function(a){this.joint=a.getAttribute("joint").split("/").pop(),this.links=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"link":this.links.push((new Ta).parse(c));break;case"rotate":case"translate":case"matrix":this.transforms.push((new oa).parse(c))}}return this},{load:G,parse:H,setPreferredShading:I,applySkin:W,geometries:k,options:C}};